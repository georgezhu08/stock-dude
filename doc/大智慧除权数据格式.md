# **大智慧分红文件（SPLIT.PWR）格式说明**

### 1. **文件头**

* **前8字节**为文件头，内容未知，通常可直接跳过。

---

### 2. **分红记录区**

* 从第9字节开始，每**120字节**为一条记录（block）。

#### **每条分红记录结构如下：**

| 偏移量 | 长度 | 类型        | 含义          | 说明/备注             |
| --- | -- | --------- | ----------- | ----------------- |
| 0   | 4  | int32 LE  | tag         | -1:股票代码切换，其他:分红记录 |
| 4   | 4  | float LE  | bonus?      | 用于兼容部分旧格式         |
| 8   | 4  | float LE  | 保留          |                   |
| 12  | 4  | float LE  | 保留          |                   |
| 16  | 4  | float LE  | bonus?      | 用于兼容部分旧格式         |
| 20  | 32 | char\[32] | 说明文本（GBK编码） | "每10股派2.50元送1股"等  |
| 52  | 68 | char\[68] | 未用/保留       |                   |
| 120 |    |           |             | 下一条记录起始           |

---

### **tag 字段说明**

* **tag = -1** 时，表示**后面是一个股票代码切换块**：

  * **第6-12字节**为股票代码（GBK编码，可能6字节长度），如 `600000`，用于后续分红记录关联该股票。
  * 这种记录**没有有效分红数据**，仅做股票切换。

* **tag ≠ -1** 时，表示**实际的分红记录**：

  * 使用当前股票代码，解析该 block 的分红数据。

---

### **分红数据的来源**

1. **说明文本解析**（优先级高）：

   * 位于 20\~51 字节（32字节，GBK编码）。
   * 常见格式："每10股派2.50元送1股转增1股配股价10元"
   * 用关键字`派`、`送`、`增`、`股`、`价`、`红`等提取分红、送股、转增、配股、配股价、红利信息。
   * 数据通常为“每10股派2.5元”，实际每股为提取数字/10。

2. **float 字段兼容**（如文本无法解析）：

   * 直接从 offset 4 或 16 位置读取 float32 数据。

---

### **股票代码关联机制**

* 只有遇到 tag = -1 的块，才需要读取新的股票代码。
* 其余分红记录都属于最近一次设置的 currentCode。

---

### **小结（文件结构图解）**

```
[ 8字节文件头 ]
[
  120字节记录1(tag=-1, 股票代码)
  120字节记录2(tag!= -1, 分红数据, 属于上面股票代码)
  120字节记录3(tag!= -1, 分红数据, 属于上面股票代码)
  ...
  120字节记录n(tag=-1, 股票代码)
  ...
]
```

---

## **举例说明**

假设记录块内容如下（伪结构）：

* block1: tag=-1, 股票代码: 600000
* block2: tag=时间戳, 分红说明文本: "每10股派3.0元送2股"
* block3: tag=时间戳, 分红说明文本: "每10股转增1股"
* block4: tag=-1, 股票代码: 000001
* block5: tag=时间戳, 分红说明文本: "每10股派2.5元"

---

## **要点归纳**

1. **每条记录120字节**，前8字节为文件头。
2. **tag=-1**块为股票代码切换块，第6\~12字节为股票代码（GBK编码）。
3. **tag≠-1**为分红数据块：主要信息在20\~51字节的GBK说明文本中，通过关键字匹配。
4. 如果说明文本解析失败，可尝试从float字段直接读取分红数据。
5. 只有代码以0/3/6开头（A股）才处理。

---

如需进一步对每个字段做更详细的二进制解释，可以配合`hexdump -C`命令查看实际文件内容加以验证。
